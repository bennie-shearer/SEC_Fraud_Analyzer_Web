<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEC EDGAR Fraud Analyzer v2.2.0</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Menu Bar -->
    <div class="menubar">
        <div class="menu-item" data-menu="file">
            <span>File</span>
            <div class="dropdown-menu" id="file-menu">
                <div class="menu-option" onclick="exportResults('json')"><span class="shortcut">Ctrl+S</span>Export JSON</div>
                <div class="menu-option" onclick="exportResults('csv')"><span class="shortcut">Ctrl+E</span>Export CSV</div>
                <div class="menu-option" onclick="exportResults('html')"><span class="shortcut">Ctrl+H</span>Export HTML</div>
                <div class="menu-divider"></div>
                <div class="menu-option" onclick="printReport()"><span class="shortcut">Ctrl+P</span>Print Report</div>
                <div class="menu-divider"></div>
                <div class="menu-option" onclick="exitApplication()"><span class="shortcut">Alt+F4</span>Exit</div>
            </div>
        </div>
        <div class="menu-item" data-menu="view">
            <span>View</span>
            <div class="dropdown-menu" id="view-menu">
                <div class="menu-option" onclick="toggleDarkMode()"><span class="shortcut">Ctrl+D</span>Toggle Dark Mode</div>
                <div class="menu-option" onclick="toggleDemoMode()"><span class="shortcut">Ctrl+M</span>Toggle Demo Mode</div>
                <div class="menu-divider"></div>
                <div class="menu-option" onclick="showHistory()">Analysis History</div>
            </div>
        </div>
        <div class="menu-item" data-menu="tools">
            <span>Tools</span>
            <div class="dropdown-menu" id="tools-menu">
                <div class="menu-option" onclick="showBatchAnalysis()">Batch Analysis...</div>
                <div class="menu-option" onclick="showCIKLookup()">CIK Lookup...</div>
                <div class="menu-divider"></div>
                <div class="menu-option" onclick="clearCache()">Clear Cache</div>
            </div>
        </div>
        <div class="menu-item" data-menu="connect">
            <span>Connect</span>
            <div class="dropdown-menu" id="connect-menu">
                <div class="menu-option" onclick="showConnectionSettings()">Connection Settings...</div>
                <div class="menu-option" onclick="testConnection()">Test Connection</div>
                <div class="menu-divider"></div>
                <div class="menu-option" onclick="loadConfigFile()">Load config.json</div>
                <div class="menu-option" onclick="saveConfigFile()">Save config.json</div>
            </div>
        </div>
        <div class="menu-item" data-menu="help">
            <span>Help</span>
            <div class="dropdown-menu" id="help-menu">
                <div class="menu-option" onclick="showHelp()"><span class="shortcut">F1</span>Help Topics</div>
                <div class="menu-option" onclick="showKeyboardShortcuts()">Keyboard Shortcuts</div>
                <div class="menu-divider"></div>
                <div class="menu-option" onclick="showAbout()">About</div>
            </div>
        </div>
        <div class="connection-status" id="connection-status" onclick="showConnectionSettings()">
            <span class="status-dot disconnected" id="status-dot"></span>
            <span id="status-text">Not Connected</span>
        </div>
    </div>

    <!-- Toolbar -->
    <div class="toolbar">
        <button class="tool-btn" onclick="exportResults('json')" title="Export JSON (Ctrl+S)">
            <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
        </button>
        <button class="tool-btn" onclick="printReport()" title="Print (Ctrl+P)">
            <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/></svg>
        </button>
        <div class="toolbar-divider"></div>
        <button class="tool-btn" onclick="showBatchAnalysis()" title="Batch Analysis">
            <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z"/></svg>
        </button>
        <button class="tool-btn" onclick="showCIKLookup()" title="CIK Lookup (for delisted companies)">
            <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
        </button>
        <div class="toolbar-divider"></div>
        <button class="tool-btn" onclick="toggleDarkMode()" title="Dark Mode (Ctrl+D)">
            <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.06 7 9.54 0 4.48-2.94 8.27-7 9.54.95.3 1.95.46 3 .46 5.52 0 10-4.48 10-10S14.52 2 9 2z"/></svg>
        </button>
        <button class="tool-btn" id="demo-mode-btn" onclick="toggleDemoMode()" title="Demo Mode (Ctrl+M)">
            <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>
        </button>
        <button class="tool-btn" onclick="showConnectionSettings()" title="Connection Settings">
            <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
        </button>
    </div>

    <!-- Main Content -->
    <div class="container">
        <header>
            <h1>SEC EDGAR Fraud Analyzer</h1>
            <p>Advanced financial forensics and fraud detection for SEC filings</p>
            <span class="version-badge">v2.2.0 - Filing-by-Filing Analysis</span>
        </header>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-row">
                <div class="form-group ticker-group">
                    <label for="ticker">Stock Ticker</label>
                    <input type="text" id="ticker" placeholder="AAPL, MSFT, etc." autocomplete="off">
                </div>
                <div class="form-group cik-group" style="display:none;">
                    <label for="cik">SEC CIK Number</label>
                    <input type="text" id="cik" placeholder="0001024401 (for delisted)">
                </div>
                <div class="form-group">
                    <label for="scope">Analysis Scope</label>
                    <select id="scope">
                        <option value="5">Recent (5 Years)</option>
                        <option value="3">Last 3 Years</option>
                        <option value="10">Extended (10 Years)</option>
                        <option value="all">All Available</option>
                    </select>
                </div>
                <div class="form-group btn-group">
                    <button class="btn btn-primary" onclick="analyzeCompany()">
                        <svg viewBox="0 0 24 24" width="16" height="16"><circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="2"/><line x1="21" y1="21" x2="16.65" y2="16.65" stroke="currentColor" stroke-width="2"/></svg>
                        Analyze
                    </button>
                    <button class="btn btn-secondary" onclick="listFilings()">
                        <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>
                        List Filings
                    </button>
                </div>
            </div>
            <div class="options-row">
                <label class="checkbox-label">
                    <span>Analysis Options:</span>
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="include-10k" checked> Include 10-K (Annual)
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="include-10q" checked> Include 10-Q (Quarterly)
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="include-amendments" checked> Include Amendments
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="include-raw"> Include Raw Financials
                </label>
                <label class="checkbox-label" style="margin-left:auto;">
                    <input type="checkbox" id="use-cik" onchange="toggleCIKInput()"> Use CIK (for delisted)
                </label>
            </div>
        </div>

        <!-- Alert Area -->
        <div id="alert-area"></div>

        <!-- Loading Indicator -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Analyzing SEC filings...</p>
        </div>

        <!-- Results Section -->
        <div id="results" class="results hidden">
            <!-- Company Header -->
            <div class="company-header" id="company-header"></div>

            <!-- Tab Navigation -->
            <div class="tabs">
                <button class="tab active" data-tab="overview">Overview</button>
                <button class="tab" data-tab="models">Fraud Models</button>
                <button class="tab" data-tab="filings">Filing Analysis</button>
                <button class="tab" data-tab="trends">Trends</button>
                <button class="tab" data-tab="redflags">Red Flags</button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content active" id="tab-overview"></div>
            <div class="tab-content" id="tab-models"></div>
            <div class="tab-content" id="tab-filings"></div>
            <div class="tab-content" id="tab-trends"></div>
            <div class="tab-content" id="tab-redflags"></div>
        </div>

        <footer>
            <p>SEC EDGAR Fraud Analyzer v2.2.0 | Author: Bennie Shearer (Retired)</p>
            <p>NOT funded, endorsed, or approved by the U.S. Securities and Exchange Commission.</p>
            <p>Data sourced from SEC EDGAR. For educational and research purposes only.</p>
        </footer>
    </div>

    <!-- Connection Settings Modal -->
    <div class="modal" id="connection-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Connection Settings</h3>
                <button class="close-btn" onclick="closeModal('connection-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="api-url">API Server URL</label>
                    <input type="text" id="api-url" placeholder="http://localhost:8080">
                    <small class="hint">Enter BASE URL only (e.g., http://localhost:8080). The client appends /api/* paths automatically.</small>
                </div>
                <div class="form-group">
                    <label for="timeout">Request Timeout (seconds)</label>
                    <input type="number" id="timeout" value="30" min="5" max="300">
                </div>
                <div class="connection-info" id="connection-info">
                    <div><strong>Status:</strong> <span id="conn-status">Not Connected</span></div>
                    <div><strong>Server:</strong> <span id="conn-server">(not configured)</span></div>
                    <div><strong>Version:</strong> <span id="conn-version">-</span></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('connection-modal')">Cancel</button>
                <button class="btn btn-secondary" onclick="testConnectionFromModal()">Test Connection</button>
                <button class="btn btn-primary" onclick="saveConnectionSettings()">Save &amp; Connect</button>
            </div>
        </div>
    </div>

    <!-- CIK Lookup Modal -->
    <div class="modal" id="cik-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>CIK Lookup</h3>
                <button class="close-btn" onclick="closeModal('cik-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>Look up SEC Central Index Key (CIK) for delisted or historical companies.</p>
                <div class="form-group">
                    <label for="cik-search">Company Name or Former Ticker</label>
                    <input type="text" id="cik-search" placeholder="Enron, WorldCom, etc.">
                </div>
                <div class="cik-results" id="cik-results">
                    <p class="hint">Common historical CIKs:</p>
                    <ul class="cik-list">
                        <li><strong>Enron Corp:</strong> 0001024401</li>
                        <li><strong>WorldCom:</strong> 0000723527</li>
                        <li><strong>Lehman Brothers:</strong> 0000806085</li>
                        <li><strong>Bear Stearns:</strong> 0000777001</li>
                        <li><strong>Washington Mutual:</strong> 0000933136</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('cik-modal')">Close</button>
                <button class="btn btn-primary" onclick="searchCIK()">Search SEC</button>
            </div>
        </div>
    </div>

    <!-- Batch Analysis Modal -->
    <div class="modal" id="batch-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Batch Analysis</h3>
                <button class="close-btn" onclick="closeModal('batch-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="batch-tickers">Ticker Symbols (one per line or comma-separated)</label>
                    <textarea id="batch-tickers" rows="6" placeholder="AAPL&#10;MSFT&#10;GOOGL&#10;AMZN"></textarea>
                </div>
                <div class="form-group">
                    <label for="batch-scope">Analysis Scope</label>
                    <select id="batch-scope">
                        <option value="3">Last 3 Years</option>
                        <option value="5" selected>Recent (5 Years)</option>
                        <option value="10">Extended (10 Years)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('batch-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="runBatchAnalysis()">Run Batch Analysis</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="help-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Help - SEC EDGAR Fraud Analyzer</h3>
                <button class="close-btn" onclick="closeModal('help-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Getting Started</h4>
                <p>Enter a stock ticker symbol and click Analyze to examine SEC filings for potential fraud indicators.</p>
                
                <h4>Fraud Detection Models</h4>
                <ul>
                    <li><strong>Beneish M-Score:</strong> Detects earnings manipulation (threshold: -2.22)</li>
                    <li><strong>Altman Z-Score:</strong> Predicts bankruptcy risk</li>
                    <li><strong>Piotroski F-Score:</strong> Measures financial strength (0-9 scale)</li>
                    <li><strong>Fraud Triangle:</strong> Analyzes pressure, opportunity, rationalization</li>
                    <li><strong>Benford's Law:</strong> Tests digit distribution for anomalies</li>
                </ul>
                
                <h4>Analyzing Delisted Companies</h4>
                <p>For companies no longer traded (e.g., Enron, WorldCom):</p>
                <ol>
                    <li>Check "Use CIK (for delisted)" option</li>
                    <li>Use Tools &gt; CIK Lookup to find the CIK number</li>
                    <li>Enter the CIK number instead of ticker</li>
                </ol>
                
                <h4>Demo Mode</h4>
                <p>Toggle Demo Mode (Ctrl+M) to test the interface with sample data without requiring a server connection.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('help-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal" id="about-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>About SEC EDGAR Fraud Analyzer</h3>
                <button class="close-btn" onclick="closeModal('about-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="about-content">
                    <h2>SEC EDGAR Fraud Analyzer</h2>
                    <p class="version">Version 2.2.0</p>
                    <p><strong>Author:</strong> Bennie Shearer (Retired)</p>
                    <p>Advanced financial forensics and fraud detection for SEC filings using proven academic models.</p>
                    <hr>
                    <p><strong>Features:</strong></p>
                    <ul>
                        <li>Beneish M-Score Analysis</li>
                        <li>Altman Z-Score Calculation</li>
                        <li>Piotroski F-Score Evaluation</li>
                        <li>Fraud Triangle Assessment</li>
                        <li>Benford's Law Testing</li>
                        <li>CIK Lookup for Delisted Companies</li>
                        <li>Config.json Support</li>
                    </ul>
                    <hr>
                    <p class="acknowledgments">
                        <strong>Acknowledgments:</strong><br>
                        Walter Hamscher - Mentor and XBRL expert<br>
                        SEC EDGAR - Financial data source<br>
                        Academic researchers - Beneish, Altman, Piotroski, Cressey, Benford<br>
                        CLion by JetBrains s.r.o.<br>
                        Claude by Anthropic PBC
                    </p>
                    <p class="disclaimer"><strong>DISCLAIMER:</strong> This project is NOT funded, endorsed, or approved by the U.S. Securities and Exchange Commission (SEC).</p>
                    <p class="copyright">MIT License - For educational and research purposes only.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('about-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div class="modal" id="shortcuts-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Keyboard Shortcuts</h3>
                <button class="close-btn" onclick="closeModal('shortcuts-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <table class="shortcuts-table">
                    <tr><td>Ctrl+S</td><td>Export to JSON</td></tr>
                    <tr><td>Ctrl+E</td><td>Export to CSV</td></tr>
                    <tr><td>Ctrl+H</td><td>Export to HTML</td></tr>
                    <tr><td>Ctrl+P</td><td>Print Report</td></tr>
                    <tr><td>Ctrl+D</td><td>Toggle Dark Mode</td></tr>
                    <tr><td>Ctrl+M</td><td>Toggle Demo Mode</td></tr>
                    <tr><td>F1</td><td>Help</td></tr>
                    <tr><td>Escape</td><td>Close Modal</td></tr>
                    <tr><td>Alt+F4</td><td>Exit</td></tr>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('shortcuts-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="history-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Analysis History</h3>
                <button class="close-btn" onclick="closeModal('history-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="history-list"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="clearHistory()">Clear History</button>
                <button class="btn btn-primary" onclick="closeModal('history-modal')">Close</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
